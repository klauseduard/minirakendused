<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZFD132PZ0Z"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        gtag('config', 'G-ZFD132PZ0Z', {
            'page_path': '/minirakendused/gardening_calendar'
        });
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring Gardening and Planting Calendar</title>
    <link rel="stylesheet" href="gardening_calendar/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Spring Gardening and Planting Calendar</h1>
            <div class="quick-jump-menu" id="quickJumpMenu">
                <div class="quick-jump-title">Quick Navigation:</div>
                <button class="quick-jump-btn" data-section="location-setup">
                    <span class="nav-icon">üìç</span> Location
                </button>
                <button class="quick-jump-btn" data-section="weather-info">
                    <span class="nav-icon">üå§Ô∏è</span> Weather
                </button>
                <button class="quick-jump-btn" data-section="search-section">
                    <span class="nav-icon">ü§ñ</span> Search & AI
                </button>
                <button class="quick-jump-btn" data-section="monthly-calendar">
                    <span class="nav-icon">üìÖ</span> Calendar
                </button>
                <button class="quick-jump-btn" data-section="garden-journal">
                    <span class="nav-icon">üìî</span> Journal
                </button>
            </div>
        </header>

        <main class="main-layout">
            <!-- Location and Units Controls -->
            <section class="top-controls" id="location-setup">
                <div class="location-row">
                    <div class="location-input-group">
                        <label for="locationInput" class="visually-hidden">Location</label>
                        <input type="text" class="location-input" id="locationInput" 
                            placeholder="City or place name (e.g., Paris, Barcelona)" 
                            aria-label="Location">
                        <button type="button" id="clearLocationBtn" class="location-clear-btn" 
                            aria-label="Clear location">√ó</button>
                    </div>
                    <button class="location-action-btn search-location-btn" id="searchLocationBtn">
                        <span class="search-icon">üîç</span> Search
                    </button>
                    <button class="location-action-btn geo-location-btn" id="useMyLocationBtn">
                        <span class="location-icon">üìç</span> My Location
                    </button>
                </div>
                <div class="units-row">
                    <div class="unit-group">
                        <label for="tempUnitSelect">Temperature:</label>
                        <select id="tempUnitSelect" aria-label="Temperature unit">
                            <option value="C">Celsius (¬∞C)</option>
                            <option value="F">Fahrenheit (¬∞F)</option>
                        </select>
                    </div>
                    <div class="unit-group">
                        <label for="precipUnitSelect">Precipitation:</label>
                        <select id="precipUnitSelect" aria-label="Precipitation unit">
                            <option value="mm">Millimeters (mm)</option>
                            <option value="in">Inches (in)</option>
                        </select>
                    </div>
                </div>
                <div id="climateZoneInfo"></div>
            </section>

            <!-- Weather Display -->
            <section class="weather-display" id="weather-info">
                <div class="weather-placeholder" id="weatherPlaceholder">
                    Weather information for your location will appear here.
                </div>
            </section>

            <!-- Search Bar -->
            <section class="search-bar" id="search-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2 class="search-section-title">Search & AI Garden Assistant</h2>
                    <button id="aiAdviceBtn" class="ai-advice-btn" style="padding: 8px 16px; background: var(--secondary-color); color: white; border: none; border-radius: 20px; display: flex; align-items: center; gap: 8px; font-weight: 500; cursor: pointer; transition: background-color 0.3s;">
                        <span style="font-size: 1.2em;">ü§ñ</span>
                        <span>Generate AI gardening advice prompt</span>
                    </button>
                </div>
                <div class="search-container">
                    <label for="searchBox" class="visually-hidden">Search for plants or tasks</label>
                    <input type="text" class="search-box" id="searchBox" 
                        placeholder="Type to search for specific plants or garden tasks..." 
                        aria-label="Search for plants or tasks">
                </div>
            </section>

            <!-- Month Navigation -->
            <section class="month-navigation" id="monthly-calendar">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2 class="month-nav-title">Select Growing Period</h2>
                </div>
                <div class="calendar-nav">
                    <button class="month-btn active" data-month="april">April</button>
                    <button class="month-btn" data-month="may">May</button>
                    <button class="month-btn" data-month="early_june">Early June</button>
                </div>
            </section>

            <!-- Calendar Content -->
            <section class="calendar-content" id="calendarContent">
                <!-- Content will be added by JavaScript -->
            </section>

            <!-- Garden Journal Section -->
            <section class="garden-journal" id="garden-journal" style="display: none;">
                <div class="journal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 class="journal-title" style="color: var(--primary-color); font-size: 1.4rem;">Garden Journal</h2>
                    <div style="display: flex; gap: 10px;">
                        <button id="exportJournalBtn" class="journal-btn" style="padding: 8px 12px; background: var(--primary-color); color: white; border: none; border-radius: 20px; display: flex; align-items: center; gap: 5px; font-weight: 500; cursor: pointer; transition: background-color 0.3s;">
                            <span style="font-size: 1.1em;">üì§</span>
                            <span>Export</span>
                        </button>
                        <button id="importJournalBtn" class="journal-btn" style="padding: 8px 12px; background: var(--primary-color); color: white; border: none; border-radius: 20px; display: flex; align-items: center; gap: 5px; font-weight: 500; cursor: pointer; transition: background-color 0.3s;">
                            <span style="font-size: 1.1em;">üì•</span>
                            <span>Import</span>
                        </button>
                        <button id="addJournalEntryBtn" class="journal-add-btn" style="padding: 8px 12px; background: var(--secondary-color); color: white; border: none; border-radius: 20px; display: flex; align-items: center; gap: 5px; font-weight: 500; cursor: pointer; transition: background-color 0.3s;">
                            <span style="font-size: 1.1em;">‚ûï</span>
                            <span>New Entry</span>
                        </button>
                    </div>
                </div>
                
                <div class="journal-tabs">
                    <button class="journal-tab active" data-view="timeline">Timeline</button>
                    <button class="journal-tab" data-view="gallery">Photo Gallery</button>
                    <button class="journal-tab" data-view="calendar">Calendar</button>
                </div>
                
                <div id="journalContent" class="journal-content" style="background: var(--white); border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px var(--shadow);">
                    <!-- Will be populated by JavaScript -->
                    <div id="emptyJournalMessage" style="text-align: center; padding: 40px 20px;">
                        <div style="font-size: 3rem; margin-bottom: 20px;">üìî</div>
                        <h3 style="margin-bottom: 15px; color: var(--primary-color);">Your Garden Journal is Empty</h3>
                        <p style="margin-bottom: 20px; color: #666;">Start documenting your gardening journey by adding your first entry!</p>
                        <button id="emptyJournalAddBtn" class="journal-add-btn" style="padding: 10px 20px; background: var(--secondary-color); color: white; border: none; border-radius: 20px; font-weight: 500; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
                            <span>‚ûï</span> Add First Entry
                        </button>
                    </div>
                    
                    <div id="journalTimeline" style="display: none;">
                        <!-- Timeline entries will be added here -->
                    </div>
                    
                    <div id="journalGallery" style="display: none;">
                        <!-- Photo gallery will be added here -->
                    </div>
                    
                    <div id="journalCalendar" style="display: none;">
                        <!-- Calendar view will be added here -->
                    </div>
                </div>
            </section>

            <button class="scroll-to-top" id="scrollToTop" aria-label="Scroll to top" style="display: none;">
                ‚Üë
            </button>
        </main>

        <!-- Prompt Generator Modal -->
        <div id="promptGeneratorModal" class="weather-modal-overlay" style="display: none;">
            <div class="weather-modal" style="width: 90%; max-width: 800px;">
                <button class="weather-modal-close" id="closePromptGeneratorBtn" aria-label="Close prompt generator">&times;</button>
                <div class="weather-modal-title">AI Gardening Assistant</div>
                <div style="margin: 20px 0;">
                    <p style="margin-bottom: 15px; color: #666;">
                        This tool will generate a comprehensive prompt based on your location, weather, and garden information. 
                        You can use this prompt with any AI assistant to get personalized gardening advice.
                    </p>
                    <div style="margin-bottom: 15px;">
                        <label for="customNotes" style="display: block; margin-bottom: 8px; font-weight: 500;">Your notes about your garden:</label>
                        <textarea id="customNotes" rows="4" style="width: 100%; padding: 10px; border: 1px solid var(--secondary-color); border-radius: 8px; margin-bottom: 10px;" placeholder="Describe your garden's current state, what you've already done, or ask specific questions..."></textarea>
                    </div>
                    <div style="margin-bottom: 15px; padding: 12px; background: #fff3e0; border-radius: 8px;">
                        <h3 style="margin-bottom: 10px; color: #e65100; font-size: 1rem;">Include in Prompt:</h3>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: block;">
                                <input type="checkbox" id="includeCalendar" checked>
                                Selected plants and tasks
                                <span style="margin-left: 5px; color: #666; font-size: 0.9em;">
                                    (Your checked items from the planting calendar)
                                </span>
                            </label>
                            <label style="display: block;">
                                <input type="checkbox" id="includeRelevantPlantsOnly" checked>
                                Filter for weather conditions
                                <span style="margin-left: 5px; color: #666; font-size: 0.9em;">
                                    (Only include plants suitable for current forecast)
                                </span>
                            </label>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button id="generatePromptBtn" class="location-btn">Generate Prompt</button>
                        <button id="copyPromptBtn" class="location-btn" style="background: var(--accent-color);">Copy to Clipboard</button>
                    </div>
                    <div id="generatedPrompt" style="background: #f8faf5; border-radius: 8px; padding: 15px; white-space: pre-wrap; font-family: monospace; max-height: 400px; overflow-y: auto;">
                        Click "Generate Prompt" to create a customized gardening prompt based on your location, weather, and calendar data.
                    </div>
                    
                    <!-- AI Assistants Integration -->
                    <div id="promptDestinationSection" style="margin-top: 20px; display: none;">
                        <h3 style="margin-bottom: 15px; font-size: 1.1rem; color: var(--primary-color);">Send Prompt Directly To:</h3>
                        <div class="ai-assistants-grid">
                            <button class="ai-assistant-btn" data-assistant="chatgpt">
                                <div class="ai-icon" style="background-color: #10a37f; color: white; border-radius: 8px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                    </svg>
                                </div>
                                <span>ChatGPT</span>
                            </button>
                            <button class="ai-assistant-btn" data-assistant="claude">
                                <div class="ai-icon" style="background-color: #9A5CF2; color: white; border-radius: 8px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M12 16v-4"></path>
                                        <path d="M12 8h.01"></path>
                                    </svg>
                                </div>
                                <span>Claude</span>
                            </button>
                            <button class="ai-assistant-btn" data-assistant="gemini">
                                <div class="ai-icon" style="background-color: #1E88E5; color: white; border-radius: 8px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                    </svg>
                                </div>
                                <span>Gemini</span>
                            </button>
                            <button class="ai-assistant-btn" data-assistant="copilot">
                                <div class="ai-icon" style="background-color: #0F6CBD; color: white; border-radius: 8px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M9 18l6-6-6-6"></path>
                                    </svg>
                                </div>
                                <span>Copilot</span>
                            </button>
                            <button class="ai-assistant-btn" data-assistant="mistral">
                                <div class="ai-icon" style="background-color: #DE5833; color: white; border-radius: 8px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M20 12V8H6a2 2 0 1 1 0-4h12v4"></path>
                                        <path d="M4 12v4h14a2 2 0 1 1 0 4H4v-4"></path>
                                    </svg>
                                </div>
                                <span>Mistral</span>
                            </button>
                            <button class="ai-assistant-btn" data-assistant="deepseek">
                                <div class="ai-icon" style="background-color: #1B7A9F; color: white; border-radius: 8px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="5"></circle>
                                        <line x1="12" y1="1" x2="12" y2="3"></line>
                                        <line x1="12" y1="21" x2="12" y2="23"></line>
                                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                        <line x1="1" y1="12" x2="3" y2="12"></line>
                                        <line x1="21" y1="12" x2="23" y2="12"></line>
                                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                                    </svg>
                                </div>
                                <span>DeepSeek</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Journal Entry Modal -->
        <div id="journalEntryModal" class="weather-modal-overlay" style="display: none;">
            <div class="weather-modal" style="width: 90%; max-width: 800px;">
                <button class="weather-modal-close" id="closeJournalEntryBtn" aria-label="Close journal entry">&times;</button>
                <div class="weather-modal-title" id="journalEntryModalTitle">Add Journal Entry</div>
                <div style="margin: 20px 0;">
                    <form id="journalEntryForm">
                        <input type="hidden" id="journalEntryId">
                        
                        <div style="margin-bottom: 20px;">
                            <label for="entryDate" style="display: block; margin-bottom: 8px; font-weight: 500;">Date:</label>
                            <input type="date" id="entryDate" style="padding: 10px; border: 1px solid var(--secondary-color); border-radius: 8px; width: 100%;" required>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label for="entryType" style="display: block; margin-bottom: 8px; font-weight: 500;">Entry Type:</label>
                            <select id="entryType" style="padding: 10px; border: 1px solid var(--secondary-color); border-radius: 8px; width: 100%;" required>
                                <option value="planting">üå± Planting</option>
                                <option value="care">üåø Garden Care</option>
                                <option value="harvest">ü•ï Harvest</option>
                                <option value="observation">üëÅÔ∏è Observation</option>
                                <option value="maintenance">üß∞ Maintenance</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label for="entryLocation" style="display: block; margin-bottom: 8px; font-weight: 500;">Location in Garden:</label>
                            <input type="text" id="entryLocation" style="padding: 10px; border: 1px solid var(--secondary-color); border-radius: 8px; width: 100%;" placeholder="e.g., North bed, Container #3">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label for="entryPlants" style="display: block; margin-bottom: 8px; font-weight: 500;">Plants:</label>
                            <select id="entryPlants" style="padding: 10px; border: 1px solid var(--secondary-color); border-radius: 8px; width: 100%;" multiple>
                                <!-- Will be populated from the calendar data -->
                            </select>
                            <div style="margin-top: 8px; font-size: 0.9em; color: #666;">
                                Hold Ctrl/Cmd to select multiple plants
                            </div>
                        </div>
                        
                        <div id="harvestMetricsContainer" style="margin-bottom: 20px; display: none;">
                            <h4 style="margin-bottom: 12px; color: var(--primary-color);">Harvest Metrics</h4>
                            
                            <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                                <div style="flex: 1;">
                                    <label for="harvestQuantity" style="display: block; margin-bottom: 8px; font-weight: 500;">Quantity:</label>
                                    <input type="number" id="harvestQuantity" min="0" step="0.1" style="padding: 10px; border: 1px solid var(--secondary-color); border-radius: 8px; width: 100%;" placeholder="e.g., 2.5">
                                </div>
                                <div style="flex: 1;">
                                    <label for="harvestUnit" style="display: block; margin-bottom: 8px; font-weight: 500;">Unit:</label>
                                    <select id="harvestUnit" style="padding: 10px; border: 1px solid var(--secondary-color); border-radius: 8px; width: 100%;">
                                        <option value="kg">Kilograms (kg)</option>
                                        <option value="lb">Pounds (lb)</option>
                                        <option value="g">Grams (g)</option>
                                        <option value="oz">Ounces (oz)</option>
                                        <option value="count">Count (pieces)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div>
                                <label for="harvestQuality" style="display: block; margin-bottom: 8px; font-weight: 500;">Quality Rating:</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="range" id="harvestQuality" min="1" max="5" value="3" style="flex: 1;">
                                    <span id="qualityRatingText">Good</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label for="entryNotes" style="display: block; margin-bottom: 8px; font-weight: 500;">Notes:</label>
                            <textarea id="entryNotes" rows="4" style="width: 100%; padding: 10px; border: 1px solid var(--secondary-color); border-radius: 8px;" placeholder="Describe what you did, observed, or harvested..."></textarea>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">Photos:</label>
                            <div id="photoUploadContainer" style="border: 2px dashed var(--secondary-color); border-radius: 8px; padding: 20px; text-align: center;">
                                <div id="dragDropText">
                                    <div style="font-size: 2rem; margin-bottom: 10px;">üì∑</div>
                                    <p>Drag and drop photos here or <label for="photoInput" style="color: var(--primary-color); cursor: pointer;">browse</label></p>
                                </div>
                                <input type="file" id="photoInput" accept="image/*" multiple style="display: none;">
                                <div id="photoPreviewContainer" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px;"></div>
                            </div>
                            <div id="storageWarning" style="margin-top: 8px; font-size: 0.9em; color: #f57c00; display: none;">
                                Storage usage is high. Consider removing some photos or exporting your journal.
                            </div>
                            <div style="margin-top: 8px; font-size: 0.9em; color: #666;">
                                Photos will be automatically resized to save storage space. Maximum 5 photos per entry.
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" id="cancelJournalEntryBtn" style="padding: 10px 20px; background: #e0e0e0; color: #333; border: none; border-radius: 20px; font-weight: 500; cursor: pointer;">Cancel</button>
                            <button type="submit" id="saveJournalEntryBtn" style="padding: 10px 20px; background: var(--primary-color); color: white; border: none; border-radius: 20px; font-weight: 500; cursor: pointer;">Save Entry</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <footer>
            <p>Spring Gardening and Planting Calendar ¬© 2025</p>
        </footer>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="customConfirmModal" class="weather-modal-overlay" style="display: none; z-index: 1000;">
        <div class="weather-modal" style="max-width: 450px; padding: 25px;">
            <div id="confirmModalTitle" style="font-size: 1.2rem; font-weight: 600; color: var(--primary-color); margin-bottom: 15px;">Confirm Action</div>
            <div id="confirmModalMessage" style="margin-bottom: 25px; line-height: 1.5;">Message goes here</div>
            <div style="display: flex; justify-content: flex-end; gap: 12px;">
                <button id="confirmModalCancelBtn" class="button" style="background: #e0e0e0; color: #333; padding: 8px 16px; border: none; border-radius: 20px; cursor: pointer;">Cancel</button>
                <button id="confirmModalOkBtn" class="button" style="background: var(--primary-color); color: white; padding: 8px 16px; border: none; border-radius: 20px; cursor: pointer;">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Export Options Modal -->
    <div id="exportOptionsModal" class="weather-modal-overlay" style="display: none; z-index: 1000;">
        <div class="weather-modal" style="max-width: 450px; padding: 25px;">
            <button class="weather-modal-close" id="exportModalCloseBtn" aria-label="Close export options">&times;</button>
            <div style="font-size: 1.2rem; font-weight: 600; color: var(--primary-color); margin-bottom: 15px;">Export Options</div>
            <div style="margin-bottom: 25px; line-height: 1.5;">Choose how you would like to export your journal:</div>
            
            <div class="export-option" style="display: flex; align-items: center; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 12px; cursor: pointer;">
                <div style="margin-right: 15px; font-size: 1.5rem;">üì∑</div>
                <div style="flex-grow: 1;">
                    <div style="font-weight: 500;">Complete Export</div>
                    <div style="font-size: 0.9rem; color: #666;">Include all entries with images (larger file size)</div>
                </div>
            </div>
            
            <div class="export-option" style="display: flex; align-items: center; padding: 12px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer;">
                <div style="margin-right: 15px; font-size: 1.5rem;">üìù</div>
                <div style="flex-grow: 1;">
                    <div style="font-weight: 500;">Lightweight Export</div>
                    <div style="font-size: 0.9rem; color: #666;">Text-only export without images (smaller file size)</div>
                </div>
            </div>
            
            <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                <button id="exportOptionsCancelBtn" class="button" style="background: #e0e0e0; color: #333; padding: 8px 16px; border: none; border-radius: 20px; cursor: pointer; margin-right: 12px;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Import Options Modal -->
    <div id="importOptionsModal" class="weather-modal-overlay" style="display: none; z-index: 1000;">
        <div class="weather-modal" style="max-width: 450px; padding: 25px;">
            <button class="weather-modal-close" id="importModalCloseBtn" aria-label="Close import options">&times;</button>
            <div style="font-size: 1.2rem; font-weight: 600; color: var(--primary-color); margin-bottom: 15px;">Import Options</div>
            <div id="importStatsMessage" style="margin-bottom: 25px; line-height: 1.5;">Found entries to import.</div>
            
            <div class="import-option" style="display: flex; align-items: center; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 12px; cursor: pointer;">
                <div style="margin-right: 15px; font-size: 1.5rem;">üîÑ</div>
                <div style="flex-grow: 1;">
                    <div style="font-weight: 500;">Merge</div>
                    <div style="font-size: 0.9rem; color: #666;">Add new entries and update existing ones</div>
                </div>
            </div>
            
            <div class="import-option" style="display: flex; align-items: center; padding: 12px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer;">
                <div style="margin-right: 15px; font-size: 1.5rem;">‚ôªÔ∏è</div>
                <div style="flex-grow: 1;">
                    <div style="font-weight: 500;">Replace All</div>
                    <div style="font-size: 0.9rem; color: #666;">Delete all existing entries and use imported ones</div>
                </div>
            </div>
            
            <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                <button id="importOptionsCancelBtn" class="button" style="background: #e0e0e0; color: #333; padding: 8px 16px; border: none; border-radius: 20px; cursor: pointer;">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="weather-modal-overlay" style="display: none; z-index: 1000;">
        <div class="weather-modal" style="max-width: 450px; padding: 25px;">
            <button class="weather-modal-close" id="deleteModalCloseBtn" aria-label="Close delete confirmation">&times;</button>
            <div style="font-size: 1.2rem; font-weight: 600; color: #d32f2f; margin-bottom: 15px;">Delete Entry</div>
            <div style="margin-bottom: 25px; line-height: 1.5;">Are you sure you want to delete this journal entry? This action cannot be undone.</div>
            <div style="display: flex; justify-content: flex-end; gap: 12px;">
                <button id="deleteConfirmCancelBtn" class="button" style="background: #e0e0e0; color: #333; padding: 8px 16px; border: none; border-radius: 20px; cursor: pointer;">Cancel</button>
                <button id="deleteConfirmBtn" class="button" style="background: #d32f2f; color: white; padding: 8px 16px; border: none; border-radius: 20px; cursor: pointer;">Delete</button>
            </div>
        </div>
    </div>

    <!-- Import storage module -->
    <script type="module" src="gardening_calendar/js/storage-loader.js"></script>

    <!-- Import data module first to ensure data is available-->
    <script type="module" src="gardening_calendar/js/data-loader.js"></script>
    
    <!-- Import UI module -->
    <script type="module" src="gardening_calendar/js/ui-loader.js"></script>

    <!-- Import Weather module - must be loaded before inline script -->
    <script type="module" src="gardening_calendar/js/weather-loader.js"></script>
    
    <!-- Add our refactored journal module after data is loaded -->
    <script type="module" src="gardening_calendar/js/journal-init.js"></script>

    <script>
        // The original script will remain here for now
        // As we refactor each part, we'll move it to its respective module
        // and remove it from here.
        
        // Multi-language support
        // translations object is now imported from the data module
        
        // Load additional languages dynamically
        async function loadLanguage(lang) {
            if (lang === 'en' || translations[lang]) {
                return translations[lang];
            }
            
            try {
                const response = await fetch(`gardening_calendar/translations/${lang}.json`);
                if (!response.ok) throw new Error(`Failed to load ${lang} translation`);
                const langData = await response.json();
                translations[lang] = langData;
                return langData;
            } catch (error) {
                console.error(`Error loading ${lang} translation:`, error);
                return null;
            }
        }
        
        // Current language (default to English)
        let currentLang = 'en';
        
        // Function to translate UI elements
        async function translateUI(lang) {
            // Load language if not already loaded
            const langData = await loadLanguage(lang);
            
            if (!langData) {
                console.error(`Translation for language ${lang} not found`);
                return;
            }
            
            currentLang = lang;
            const t = langData;
            
            // Save language preference
            localStorage.setItem('gardening_language', lang);
            
            // Update document title
            document.title = t.title;
            
            // Update text elements with data-i18n attributes
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) {
                    el.textContent = t[key];
                }
            });
            
            // Update placeholders for inputs
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (t[key]) {
                    el.setAttribute('placeholder', t[key]);
                }
            });
            
            // Update aria-labels
            document.querySelectorAll('[data-i18n-aria]').forEach(el => {
                const key = el.getAttribute('data-i18n-aria');
                if (t[key]) {
                    el.setAttribute('aria-label', t[key]);
                }
            });
            
            // Update month buttons
            document.querySelectorAll('.month-btn').forEach(btn => {
                const month = btn.getAttribute('data-month');
                if (t[month]) {
                    btn.textContent = t[month];
                }
            });
            
            // Update input placeholders
            if (t.location_placeholder) {
                locationInput.setAttribute('placeholder', t.location_placeholder);
            }
            
            // Update search box placeholder
            const searchBox = document.getElementById('searchBox');
            if (searchBox && t.search_placeholder) {
                searchBox.setAttribute('placeholder', t.search_placeholder);
            }
            
            // Update calendar data for current language
            renderCalendar(activeMonth, searchBox?.value || '');
        }
        
        // Function to get translated string
        function getTranslation(key) {
            return translations[currentLang]?.[key] || key;
        }
        
        // Initialize language from localStorage or browser preference
        async function initLanguage() {
            let savedLang = localStorage.getItem('gardening_language');
            
            if (!savedLang) {
                // Try to detect from browser
                const browserLang = navigator.language.split('-')[0];
                savedLang = ['en', 'et'].includes(browserLang) ? browserLang : 'en';
            }
            
            // Check if translations are available or wait for them
            if (window.translations) {
                await translateUI(savedLang);
            } else {
                // If translations aren't available, wait for data module to load
                document.addEventListener('dataModuleLoaded', async function() {
                    await translateUI(savedLang);
                });
            }
        }
        
        // Data in JSON format
        // calendarData is now imported from the data module

        // Category icons
        // categoryIcons is now imported from the data module

        // Category names
        // categoryNames is now imported from the data module

        // DOM elements
        const calendarContent = document.getElementById('calendarContent');
        const monthButtons = document.querySelectorAll('.month-btn');
        const searchBox = document.getElementById('searchBox');
        const locationInput = document.getElementById('locationInput');
        const weatherPlaceholder = document.getElementById('weatherPlaceholder');
        const clearLocationBtn = document.getElementById('clearLocationBtn');

        // Active month (default April)
        let activeMonth = 'april';

        // Climate zone logic - keep this for now since it's still used
        let koppenGrid = null;
        let userClimateZone = null;
        let userClimateZoneOverride = null;
        const climateZoneInfo = document.getElementById('climateZoneInfo');

        // Load the grid JSON
        fetch('gardening_calendar/data/koppen_grid_0.5deg.json')
            .then(r => r.json())
            .then(data => {
                koppenGrid = data;
                // If we already have a location, try to show zone
                const cached = localStorage.getItem('gardening_last_location');
                if (cached) {
                    try {
                        const loc = JSON.parse(cached);
                        if (loc.type === 'coords' && loc.lat && loc.lon) {
                            showClimateZone(loc.lat, loc.lon);
                        }
                    } catch (e) {}
                }
            });

        // Helper: round to nearest 0.25
        function round025(x) {
            // Ensure x is a number and round to either .25 or .75
            const num = typeof x === 'string' ? parseFloat(x) : x;
            const decimal = num % 1;
            const whole = Math.floor(num);
            let rounded;
            if (decimal < 0.375) {
                rounded = 0.25;
            } else if (decimal < 0.875) {
                rounded = 0.75;
            } else {
                rounded = 0.25;
                return (whole + 1 + rounded).toFixed(2);
            }
            return (whole + rounded).toFixed(2);
        }

        // Show climate zone info
        function showClimateZone(lat, lon) {
            if (!koppenGrid) {
                climateZoneInfo.innerHTML = '';
                return;
            }
            // Check for override
            const override = localStorage.getItem('gardening_climate_zone_override');
            let lookupKey = '';
            let foundZone = '';
            if (override) {
                userClimateZoneOverride = override;
                userClimateZone = override;
                lookupKey = '(override)';
                foundZone = override;
            } else {
                const latNum = typeof lat === 'string' ? parseFloat(lat) : lat;
                const lonNum = typeof lon === 'string' ? parseFloat(lon) : lon;
                const key = `${round025(latNum)} ${round025(lonNum)}`;
                // Try exact match first
                if (koppenGrid[key]) {
                    userClimateZone = koppenGrid[key];
                    lookupKey = key;
                    foundZone = userClimateZone;
                } else {
                    // Find nearest neighbor
                    const roundedLat = round025(latNum);
                    const roundedLon = round025(lonNum);
                    let minDistance = Infinity;
                    let nearestZone = null;
                    let nearestKey = null;
                    
                    // Search in nearby coordinates (¬±1 degree should be enough)
                    for (const gridKey in koppenGrid) {
                        const [gridLat, gridLon] = gridKey.split(' ').map(Number);
                        if (Math.abs(gridLat - roundedLat) <= 1 && Math.abs(gridLon - roundedLon) <= 1) {
                            const distance = Math.sqrt(
                                Math.pow(gridLat - roundedLat, 2) + 
                                Math.pow(gridLon - roundedLon, 2)
                            );
                            if (distance < minDistance) {
                                minDistance = distance;
                                nearestZone = koppenGrid[gridKey];
                                nearestKey = gridKey;
                            }
                        }
                    }
                    
                    if (nearestZone) {
                        userClimateZone = nearestZone;
                        lookupKey = `${key} (nearest: ${nearestKey}, dist: ${minDistance.toFixed(2)}¬∞)`;
                        foundZone = nearestZone;
                    } else {
                        userClimateZone = 'Unknown';
                        lookupKey = key;
                        foundZone = 'Unknown';
                    }
                }
            }
            renderClimateZoneUI(lookupKey, foundZone);
        }

        // Render the climate zone UI (with debug info)
        function renderClimateZoneUI(lookupKey = '', foundZone = '') {
            let html = '';
            if (userClimateZone) {
                html += `<div style="margin-top: 15px; padding: 10px 15px; background: var(--white); border-radius: 8px; box-shadow: 0 1px 3px var(--shadow);">`;
                html += `<div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">`;
                html += `<strong>Climate zone:</strong> <span id="climateZoneCode" style="background: var(--light-bg); padding: 2px 8px; border-radius: 4px; font-family: monospace;">${userClimateZone}</span>`;
                html += `<a href="https://en.wikipedia.org/wiki/K%C3%B6ppen_climate_classification" target="_blank" style="color: var(--primary-color); text-decoration: none; font-size: 0.95em;">(What is this?)</a>`;
                html += `</div>`;
                html += `<div style="display: flex; align-items: center; gap: 10px;">`;
                html += `<label for="climateZoneOverride" style="font-size: 0.95em;">Override zone:</label>`;
                html += `<input id="climateZoneOverride" type="text" style="padding: 4px 8px; border: 1px solid var(--secondary-color); border-radius: 4px; width: 60px;" value="${userClimateZoneOverride || ''}" placeholder="e.g. Dfb">`;
                html += `<button id="setClimateZoneOverrideBtn" style="padding: 4px 10px; background: var(--secondary-color); color: white; border: none; border-radius: 4px; font-size: 0.95em; cursor: pointer;">Set</button>`;
                html += `<button id="clearClimateZoneOverrideBtn" style="padding: 4px 10px; background: var(--accent-color); color: white; border: none; border-radius: 4px; font-size: 0.95em; cursor: pointer;">Clear</button>`;
                html += `</div></div>`;
            }
            climateZoneInfo.innerHTML = html;

            // Add listeners
            const setBtn = document.getElementById('setClimateZoneOverrideBtn');
            const clearBtn = document.getElementById('clearClimateZoneOverrideBtn');
            if (setBtn) {
                setBtn.addEventListener('click', function() {
                    const val = document.getElementById('climateZoneOverride').value.trim();
                    if (val) {
                        localStorage.setItem('gardening_climate_zone_override', val);
                        userClimateZoneOverride = val;
                        userClimateZone = val;
                        renderClimateZoneUI();
                    }
                });
            }
            if (clearBtn) {
                clearBtn.addEventListener('click', function() {
                    localStorage.removeItem('gardening_climate_zone_override');
                    userClimateZoneOverride = null;
                    // Recompute from location
                    const cached = localStorage.getItem('gardening_last_location');
                    if (cached) {
                        try {
                            const loc = JSON.parse(cached);
                            if (loc.type === 'coords' && loc.lat && loc.lon) {
                                const latNum = typeof loc.lat === 'string' ? parseFloat(loc.lat) : loc.lat;
                                const lonNum = typeof loc.lon === 'string' ? parseFloat(loc.lon) : loc.lon;
                                showClimateZone(latNum, lonNum);
                                return;
                            }
                        } catch (e) {}
                    }
                    renderClimateZoneUI();
                });
            }
        }

        // Function to render calendar content
        function renderCalendar(month, searchTerm = '') {
            // Clear content
            calendarContent.innerHTML = '';
            
            // Check if month has data
            if (!calendarData[month]) {
                calendarContent.innerHTML = `<div class="no-results">${getTranslation('no_data_available')}</div>`;
                return;
            }
            
            // Show categories
            const categories = Object.keys(calendarData[month]);
            
            // Filter for search
            let hasResults = false;
            let delay = 0;
            
            categories.forEach(category => {
                const items = calendarData[month][category];
                let filteredItems = items;
                
                // Apply filter if search term exists
                if (searchTerm) {
                    filteredItems = items.filter(item => {
                        const itemText = item[currentLang] || item.en;
                        return itemText.toLowerCase().includes(searchTerm.toLowerCase());
                    });
                }
                
                // Don't show category if no results after filtering
                if (filteredItems.length === 0 && searchTerm) {
                    return;
                }
                
                hasResults = true;
                
                // Create category card
                const categoryCard = document.createElement('div');
                const categoryClass = category === 'garden_tasks' ? 'category-card garden-tasks-card' : 'category-card';
                categoryCard.className = `${categoryClass} fade-in`;
                categoryCard.style.animationDelay = `${delay}ms`;
                delay += 100;
                
                // Icon and title
                const isTaskCategory = category === 'garden_tasks';
                const categoryDisplayName = translations[currentLang][category] || categoryNames[category] || category;
                
                categoryCard.innerHTML = `
                    <div class="category-header">
                        <div class="category-icon">${categoryIcons[category] || 'üåø'}</div>
                        <h2 class="category-title">${categoryDisplayName}</h2>
                    </div>
                    <div class="select-all-container">
                        <label class="select-all-label">
                            <input type="checkbox" class="select-all-checkbox" data-category="${category}">
                            <span>Select All ${isTaskCategory ? 'Tasks' : 'Plants'}</span>
                        </label>
                    </div>
                    <ul class="plant-list">
                        ${filteredItems.map(item => {
                            const itemText = item[currentLang] || item.en;
                            const itemId = JSON.stringify(item); // Store the full item object
                            const displayText = searchTerm ? highlightText(itemText, searchTerm) : itemText;
                            
                            return `
                                <li class="${isTaskCategory ? 'task-item' : 'plant-item'}" data-item-id="${encodeURIComponent(itemId)}">
                                    <label class="item-label">
                                        <input type="checkbox" class="item-checkbox" 
                                            ${isItemSelected(month, category, item) ? 'checked' : ''}>
                                        <span class="item-text">${displayText}</span>
                                    </label>
                                </li>
                            `;
                        }).join('')}
                    </ul>
                `;

                // Add event listeners for checkboxes
                categoryCard.querySelectorAll('.item-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        const itemJson = decodeURIComponent(e.target.closest('li').dataset.itemId);
                        const item = JSON.parse(itemJson);
                        toggleItemSelection(month, category, item, e.target.checked);
                        // Update the "Select All" checkbox status
                        updateSelectAllCheckbox(month, category);
                    });
                });
                
                calendarContent.appendChild(categoryCard);
            });
            
            // If no results found
            if (!hasResults) {
                calendarContent.innerHTML = `<div class="no-results">${translations[currentLang].no_results || 'No results found for your search.'}</div>`;
            }

            // Add event listeners for "Select All" checkboxes
            const selectAllCheckboxes = document.querySelectorAll('.select-all-checkbox');
            selectAllCheckboxes.forEach(checkbox => {
                const category = checkbox.dataset.category;
                
                // Initial state: check if all items are selected
                const categoryItems = calendarData[month][category] || [];
                if (categoryItems.length > 0) {
                    // Check if ALL items in this category are selected
                    let allSelected = true;
                    for (let i = 0; i < categoryItems.length; i++) {
                        if (!isItemSelected(month, category, categoryItems[i])) {
                            allSelected = false;
                            break;
                        }
                    }
                    checkbox.checked = allSelected;
                    console.log(`Initializing "Select All" for ${category}: ${allSelected}`);
                }
                
                // Add change event
                checkbox.addEventListener('change', (e) => {
                    const isChecked = e.target.checked;
                    const categoryCard = e.target.closest('.category-card');
                    const checkboxes = categoryCard.querySelectorAll('.item-checkbox');
                    
                    // Update all checkboxes in this category
                    checkboxes.forEach(itemCheckbox => {
                        if (itemCheckbox.checked !== isChecked) {
                            itemCheckbox.checked = isChecked;
                            
                            // Get and update the item
                            const itemLi = itemCheckbox.closest('li');
                            const itemJson = decodeURIComponent(itemLi.dataset.itemId);
                            const item = JSON.parse(itemJson);
                            toggleItemSelection(month, category, item, isChecked);
                        }
                    });
                    
                    // Update the "Select All" checkbox status once after all items are processed
                    updateSelectAllCheckbox(month, category);
                });
            });
        }

        // Calendar item selection functions
        function isItemSelected(month, category, item) {
            const savedSelections = JSON.parse(localStorage.getItem('gardening_selected_items') || '{}');
            if (!savedSelections[month]) return false;
            if (!savedSelections[month][category]) return false;
            
            // Convert item to string for comparison
            const itemStr = JSON.stringify(item);
            return savedSelections[month][category].some(savedItem => 
                JSON.stringify(savedItem) === itemStr
            );
        }

        function toggleItemSelection(month, category, item, selected) {
            const savedSelections = JSON.parse(localStorage.getItem('gardening_selected_items') || '{}');
            
            // Initialize nested structure if not exists
            if (!savedSelections[month]) savedSelections[month] = {};
            if (!savedSelections[month][category]) savedSelections[month][category] = [];
            
            if (selected) {
                // Add item if not already present
                const itemStr = JSON.stringify(item);
                const exists = savedSelections[month][category].some(savedItem => 
                    JSON.stringify(savedItem) === itemStr
                );
                
                if (!exists) {
                    savedSelections[month][category].push(item);
                }
            } else {
                // Remove item if present
                savedSelections[month][category] = savedSelections[month][category].filter(savedItem => 
                    JSON.stringify(savedItem) !== JSON.stringify(item)
                );
            }
            
            // Save back to localStorage
            localStorage.setItem('gardening_selected_items', JSON.stringify(savedSelections));
        }

        function updateSelectAllCheckbox(month, category) {
            const checkbox = document.querySelector(`.select-all-checkbox[data-category="${category}"]`);
            if (!checkbox) return;
            
            // Check if any items exist in this category
            const categoryItems = calendarData[month][category] || [];
            if (categoryItems.length === 0) {
                checkbox.checked = false;
                return;
            }
            
            // Check if ALL items in this category are selected
            let allSelected = true;
            for (let i = 0; i < categoryItems.length; i++) {
                if (!isItemSelected(month, category, categoryItems[i])) {
                    allSelected = false;
                    break;
                }
            }
            
            checkbox.checked = allSelected;
        }

        // Search function
        function searchCalendar() {
            const searchTerm = searchBox.value.trim();
            renderCalendar(activeMonth, searchTerm);
        }

        // Text highlighting function
        function highlightText(text, searchTerm) {
            if (!searchTerm) return text;
            
            const regex = new RegExp(`(${escapeRegExp(searchTerm)})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        // Escape special characters in regular expression
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // Listen for month button clicks
        monthButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons
                monthButtons.forEach(btn => btn.classList.remove('active'));
                
                // Add active class to clicked button
                button.classList.add('active');
                
                // Update active month
                activeMonth = button.dataset.month;
                
                // Show calendar
                searchBox.value = ''; // Reset search
                renderCalendar(activeMonth);
            });
        });

        // Listen for search input
        searchBox.addEventListener('input', searchCalendar);

        // Initial calendar display - wait for data module to be loaded
        let calendarInitialized = false;
        if (window.calendarData) {
            // If data is already loaded, render immediately
            renderCalendar(activeMonth);
            calendarInitialized = true;
        } else {
            // Otherwise, wait for the data module to be loaded
            document.addEventListener('dataModuleLoaded', function() {
                if (!calendarInitialized) {
                    console.log('Data module loaded, initializing calendar');
                    renderCalendar(activeMonth);
                    calendarInitialized = true;
                }
            });
        }

        // Handle clear button logic and input events
        // Show/hide clear button based on input content
        locationInput.addEventListener('input', function() {
            clearLocationBtn.style.opacity = this.value ? '0.7' : '0.2';
        });
        
        // Clear input when clear button is clicked
        clearLocationBtn.addEventListener('click', function() {
            locationInput.value = '';
            locationInput.focus();
            clearLocationBtn.style.opacity = '0.2';
        });
        
        // Set initial opacity for clear button
        clearLocationBtn.style.opacity = locationInput.value ? '0.7' : '0.2';

        // Initialize climate zone after weather module is loaded
        window.addEventListener('DOMContentLoaded', function() {
            // Wait a short time to ensure weather module is fully initialized
            setTimeout(() => {
                // Connect climate zone updates with weather updates
                const cached = localStorage.getItem('gardening_last_location');
                if (cached) {
                    try {
                        const loc = JSON.parse(cached);
                        if (loc.type === 'coords' && loc.lat && loc.lon) {
                            // If we have coordinates, show climate zone
                            showClimateZone(loc.lat, loc.lon);
                        }
                    } catch (e) {
                        console.error('Error updating climate zone:', e);
                    }
                }
                
                // Set fixed language to English
                currentLang = 'en';
                document.title = translations['en'].title;
                renderCalendar(activeMonth, searchBox?.value || '');
            }, 200);
        });

        // Navigation functionality
        document.addEventListener('DOMContentLoaded', () => {
            const quickJumpMenu = document.getElementById('quickJumpMenu');
            
            // Handle navigation button clicks
            quickJumpMenu.addEventListener('click', (e) => {
                const btn = e.target.closest('.quick-jump-btn');
                if (!btn) return;
                
                // Set active state
                quickJumpMenu.querySelectorAll('.quick-jump-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // Get target section
                const sectionId = btn.dataset.section;
                
                // Show/hide sections
                    if (sectionId === 'garden-journal') {
                    // Show only journal section
                        document.querySelectorAll('section').forEach(s => {
                            s.style.display = s.id === 'garden-journal' ? 'block' : 'none';
                        });
                    
                    // Render journal content - will be handled by the journal module
                    // since journal is displayed, the module's event listeners will detect 
                    // that it's visible and render the content
                    } else {
                    // Hide journal
                        document.getElementById('garden-journal').style.display = 'none';
                    
                    // Show other sections
                        document.querySelectorAll('section:not(#garden-journal)').forEach(s => {
                        s.style.display = 'block';
                    });
                    
                    // Scroll to the target section with offset for header
                    const targetSection = document.getElementById(sectionId);
                    if (targetSection) {
                        // Use the UI module's scrollToElement function
                        scrollToElement(targetSection, 200);
                    }
                }
            });
        });
    </script>
    
    <!-- Journal Module Loader -->
    <script type="module" src="gardening_calendar/js/journal-loader.js"></script>
</body>
</html> 
